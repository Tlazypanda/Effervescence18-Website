<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>Login</title>
  
  
  		{% load static %}
      <link rel="stylesheet" href="{% static 'login/css/style.css' %}">

  
</head>

<body>


{% csrf_token %}
  <div class="wrapper">
	<div class="container" style="height: 500px;">
		<h1>Login</h1>
		
    

		<form class="form">
			<input type="password" placeholder="Old Password" id="old_password">
      <input type="password" placeholder="New Password" id="new_password1">
      <input type="password" placeholder="Confirm New Password" id="new_password2">
			<button type="submit" id="login-button" class="login_form">Change</button>
		</form>

	</div>


</div>


  	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script  src="{% static 'login/js/index.js' %}"></script>

<script>

  var token = localStorage.getItem("token");
  if(token == null){
    token = '';
  }

  $(".login_form").on("click", function(e) {
    var old_password = $("#old_password").val();
    var new_password1 = $("#new_password1").val();
    var new_password2 = $("#new_password2").val();

    $.ajax({
      url : "/api/password/change/",
      type : 'post',
      data : {
        "old_password" : old_password,
        "new_password1" : new_password1,
        "new_password2" : new_password2,
      },
      beforeSend : function(request){
      request.setRequestHeader("Authorization",
        "Token " + token);
      },
      dataType : 'json',
      success: function(data){
        window.location.href = "/";
      },
      error: function(MLHttpRequest, textStatus, errorThrown){
        // alert(MLHttpRequest.responseJSON["non_field_errors"]);
        for(key in MLHttpRequest.responseJSON){
          alert(MLHttpRequest.responseJSON[key]);
        }
        window.location.href = "/change_password/";
      }
    });
  });
</script>



</body>

</html>
